"""
Author: Md Mostafizur Rahman
File: Question number 7

Input: Takes file name(s) as argument.
Output: Print appropriate message like "file not found", "not a JSON file", OR 
        create tables and instert data into appropriate tables.

Run Command:  python3  nvd/scripts/vuln2db.py --json_file wrong_file.json nvdcve-1.1-2021.json wrong_file.txt empty_file.json small.json nvdcve-1.1-2017.json hell.txt nvdcve-1.1-2020.json nvdcve-1.1-2018.json nvdcve-1.1-2019.json
"""

import NVD
import argparse
import mysql.connector


if __name__ == "__main__":
    connection = mysql.connector.connect(host = 'localhost', user = 'root', passwd = 'mynewpassword', db = 'test_json_db')

    parser = argparse.ArgumentParser(description="Parameter for passing dataset information")
    parser.add_argument("--json_file", required=True, nargs="+", help="Enter the name of the JSON file")
    args = parser.parse_args()
    for file in args.json_file:
        extract_data = NVD.extract(file)
        if extract_data !=False:
            intended_extract_data, intended_extract_data_vendor = NVD.nvd_extract_only_intended(extract_data)
            if intended_extract_data != False:
                NVD.save2db(intended_extract_data, intended_extract_data_vendor, connection)
        print("\n\n")
    connection.close()
    print("Database connection closed")
